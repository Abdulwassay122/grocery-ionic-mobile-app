<app-header></app-header>

<ion-content *ngIf="!loading && product; else loadingTemp">
  <!-- Product Images -->
  <div class="carousel">
    <div class="back-n-fav">
      <!-- <div (click)="goToBack()">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </div> -->
      <div (click)="addToWishList(product.id)">
        <ion-icon *ngIf="!isWished" name="heart-outline"></ion-icon>
        <ion-icon class="sharp" *ngIf="isWished" name="heart-sharp"></ion-icon>
      </div>
    </div>

    <swiper-container *ngIf="selectedVariant?.imageUrl" slides-per-view="1" pagination="true">
      <swiper-slide>
        <img [src]="selectedVariant.imageUrl" />
      </swiper-slide>
    </swiper-container>
  </div>

  <!-- Product Details -->
  <div class="product-details">
    <div class="product-name-container">
      <div class="badge" [ngClass]="product.collection">{{product.collection}}</div>
      <h1 class="product-name">{{ product.title }}</h1>

      <!-- Variant-Specific Price -->
      <h2 class="product-price">
        {{ selectedVariant.currency }} {{ selectedVariant.price }}
        <span class="weight">/ kg</span>
        <span class="cut-price">Rp 21,000</span>
      </h2>
    </div>

    <!-- Variant Selector -->
    <div class="variant-selector" *ngIf="product?.variants?.length > 1">
      <label>Select Quality:</label>
      <div class="variant-buttons">
        <button *ngFor="let variant of product.variants" [class.selected]="selectedVariant?.id === variant.id"
          (click)="selectVariant(variant)">
          {{ variant.title }}
        </button>
      </div>
    </div>
  </div>

  <!-- Product Info -->
  <div class="product-info">
    <div class="head">
      <h3>Description <div class="bar"></div>
      </h3>
      <h3>Nutrition facts</h3>
    </div>
    <p class="content">{{ product.description }}</p>
  </div>

  <!-- Related Products -->
  <div class="related-products">
    <h3>Related Product</h3>
    <swiper-container slides-per-view="auto">
      <swiper-slide>
        <ion-card class="product-card">
          <div class="image-container">
            <img src="assets/images/Rectangle 74.png" alt="Product Image" />
          </div>
          <ion-card-content>
            <h2>Fresh Carrot</h2>
            <div class="price-section">
              <p class="price">
                <span>Rp 18,000</span>
                <span class="weight">/ kg</span>
              </p>
            </div>
          </ion-card-content>
        </ion-card>
      </swiper-slide>
      <!-- More related slides if needed -->
    </swiper-container>
  </div>
</ion-content>

<ion-footer>
  <div class="button-group">
    <button class="g-1" fill="clear" (click)="decreaseQuantity()"><ion-icon name="remove-outline"></ion-icon></button>
    <button class="g-2" fill="clear">
      <p>{{quantity}}</p>
    </button>
    <button class="g-1" fill="clear" (click)="increaseQuantity()"><ion-icon name="add-outline"></ion-icon></button>
  </div>
  <button (click)="AddToCart()" fill="clear">Add to Cart</button>
</ion-footer>

<ng-template #loadingTemp>
  <ion-content>
    <!-- Skeleton Carousel -->
    <div class="carousel">
      <div class="back-n-fav">
        <ion-skeleton-text animated style="width: 24px; height: 24px; border-radius: 50%;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 24px; height: 24px; border-radius: 50%;"></ion-skeleton-text>
      </div>

      <swiper-container slides-per-view="1" pagination="true">
        <swiper-slide>
          <ion-skeleton-text animated style="width: 100%; height: 350px; border-radius: 12px;"></ion-skeleton-text>
        </swiper-slide>
      </swiper-container>
    </div>

    <!-- Skeleton Product Details -->
    <div class="product-details">
      <ion-skeleton-text animated
        style="width: 80px; height: 20px; border-radius: 8px; margin-bottom: 10px;"></ion-skeleton-text>
      <ion-skeleton-text animated style="width: 70%; height: 26px; border-radius: 6px;"></ion-skeleton-text>
      <ion-skeleton-text animated
        style="width: 60%; height: 22px; border-radius: 6px; margin-top: 10px;"></ion-skeleton-text>
    </div>

    <!-- Skeleton Variant Selector -->
    <div class="variant-selector">
      <ion-skeleton-text animated style="width: 100px; height: 18px; margin-bottom: 10px;"></ion-skeleton-text>
      <div class="variant-buttons" style="display: flex; gap: 10px;">
        <ion-skeleton-text animated style="width: 70px; height: 30px; border-radius: 6px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 70px; height: 30px; border-radius: 6px;"></ion-skeleton-text>
      </div>
    </div>

    <!-- Skeleton Description -->
    <div class="product-info">
      <div class="head" style="display: flex; justify-content: space-between;">
        <ion-skeleton-text animated style="width: 120px; height: 18px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 100px; height: 18px;"></ion-skeleton-text>
      </div>
      <ion-skeleton-text animated
        style="width: 100%; height: 60px; border-radius: 8px; margin-top: 10px;"></ion-skeleton-text>
    </div>

    <!-- Skeleton Related Products -->
    <div class="related-products">
      <ion-skeleton-text animated style="width: 150px; height: 22px; margin-bottom: 10px;"></ion-skeleton-text>
      <swiper-container slides-per-view="auto">
        <swiper-slide *ngFor="let i of [1,2,3]">
          <ion-card class="product-card">
            <div class="image-container">
              <ion-skeleton-text animated style="width: 157px; height: 131px; border-radius: 10px;"></ion-skeleton-text>
            </div>
            <ion-card-content>
              <ion-skeleton-text animated style="width: 80%; height: 18px;"></ion-skeleton-text>
              <ion-skeleton-text animated style="width: 50%; height: 16px; margin-top: 8px;"></ion-skeleton-text>
            </ion-card-content>
          </ion-card>
        </swiper-slide>
      </swiper-container>
    </div>
  </ion-content>
</ng-template>

<div *ngIf="!loading2; else loadingTemp2"></div>
<ng-template #loadingTemp2>
  <div class="loading-wrapper">
    <ion-spinner name="crescent" color="light"></ion-spinner>
    <p>Adding to Cart ...</p>
  </div>
</ng-template>
