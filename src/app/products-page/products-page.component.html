<ion-header>
  <button fill="clear" (click)="goToBack()" class="logo">
    <ion-icon name="chevron-back-outline"></ion-icon>
  </button>
  <div class="search-bar">
    <ion-icon class="search" name="search-outline"></ion-icon>
    <ion-input #searchInput (ionInput)="onInput($event)" [(ngModel)]="searchTerm" placeholder="Search..."
      showCancelButton="focus"></ion-input>
    <ion-icon (click)="clearSearch()" class="cross" name="close-outline"></ion-icon>
  </div>
  <div class="cart">
    <ion-icon (click)="goToCart()" class="logo" name="cart-outline"></ion-icon>
  </div>
</ion-header>

<ion-content>
  <!-- categories -->
  <div class="categories-section">
    <swiper-container class="categories" slides-per-view="auto" space-between="20">
      <swiper-slide (click)="goToCollection(collection.title)" *ngFor="let collection of collections" class="category"
        [ngClass]="isActive(collection.title)">
        <div class="category-image">
          <img [src]="collection.imageUrl" alt="">
        </div>
        <p>{{collection.title}}</p>
        <div class="bar"></div>
      </swiper-slide>
    </swiper-container>
  </div>

  <!-- Products  -->
  <div class="products-section" *ngIf="!loading && posts; else skeletonLoader">
    <ion-card class="product-card" *ngFor="let product of filteredPosts" (click)="goToProductdetail(product.id)">
      <div class="image-container">
        <img *ngIf="product.imageUrl" [src]="product.imageUrl" [alt]="product.altText" />
        <div (click)="addToWishList(product.id); $event.stopPropagation()" class="fav">
          <ion-icon *ngIf="!isWished(product.id)" name="heart-outline"></ion-icon>
          <ion-icon class="sharp" *ngIf="isWished(product.id)" name="heart-sharp"></ion-icon>
        </div>
      </div>

      <ion-card-content>
        <h2>{{product.title}}</h2>
        <div class="price-section">
          <p class="price">
            <span>{{product.currency}} {{product.price}}</span>
            <span class="weight">/ kg</span>
          </p>
          <p class="cut-price">PKR 21,000</p>
        </div>
        <div class="add">
          <button fill="clear" class="add-button">
            <ion-icon (click)="openVariantModal(product.varient); $event.stopPropagation()" name="add-outline"></ion-icon>
          </button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <div *ngIf="!loading2 && posts; else skeletonLoader"></div>
  <div *ngIf="!Error; else Empty"></div>
  <ion-infinite-scroll (ionInfinite)="loadMore($event)" threshold="100px">
    <ion-infinite-scroll-content></ion-infinite-scroll-content>
  </ion-infinite-scroll>

</ion-content>

<app-footer></app-footer>

<ng-template #skeletonLoader>
  <div class="products-section">
    <ion-card class="product-card" *ngFor="let i of [1,2,3,4]">
      <div class="image-container">
        <ion-skeleton-text animated style="width: 157px; height: 131px;"></ion-skeleton-text>
        <!-- <div class="fav">
          <ion-icon name="heart-outline"></ion-icon>
        </div> -->
      </div>

      <ion-card-content>
        <h2>
          <ion-skeleton-text animated style="width: 80%; height: 20px;"></ion-skeleton-text>
        </h2>
        <div class="price-section">
          <p class="price">
            <ion-skeleton-text animated style="width: 60px; height: 16px;"></ion-skeleton-text>
            <span class="weight"></span>
          </p>
          <p class="cut-price">
            <ion-skeleton-text animated style="width: 50px; height: 12px;"></ion-skeleton-text>
          </p>
        </div>
        <div class="add">
          <ion-skeleton-text animated style="width: 29px; height: 29px; border-radius: 10px;"></ion-skeleton-text>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ng-template>

<div *ngIf="!loading3; else loadingTemp2"></div>
<ng-template #loadingTemp2>
  <div class="loading-wrapper">
    <ion-spinner name="crescent" color="light"></ion-spinner>
    <p>Adding to Cart ...</p>
  </div>
</ng-template>
<ng-template #Empty>
    <p class="empty">No Products Found!</p>
</ng-template>